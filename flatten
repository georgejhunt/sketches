#!/usr/bin/python

import os.path
import os
import sys
from datetime import datetime

DEPLOYMENT="greenwave"
DATAROOT = '/root/%s/sniffr'%DEPLOYMENT
def main():
    filenames = []
    datadir = "%s/logs"%(DATAROOT,)
    for root, subdirs, names in os.walk(datadir):
        filenames.extend(names)
    numfiles = len(filenames)
    filenum = 0
    filenames.sort()
    selected_values = []
    outfile = "%s/pwr-data.csv"%DATAROOT
    outfd = open(outfile,"w")
    for fname in filenames:
        fname = os.path.join(root,fname)
        filenum+=1
        try:
	    skip = True
	    for  line in open(fname):
		    if line.startswith("<StartData>"):
			skip = False
			continue
		    if skip:
			continue
		    outfd.write(line)
        except:
            print "%s : Could not open. Error: " % fname,
            print sys.exc_info()
            continue
    outfd.close()
	    	
main()
#vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4
